<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Sensor Debug Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, 
                Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #121212;
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .sensor-section {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .sensor-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sensor-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .sensor-status {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: #333;
        }
        
        .sensor-status.available {
            background-color: #4caf50;
        }
        
        .sensor-status.unavailable {
            background-color: #f44336;
        }
        
        .sensor-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sensor-value {
            background-color: #2d2d2d;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .value-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .value-number {
            font-size: 20px;
            font-weight: 600;
            font-family: monospace;
        }
        
        .permission-button {
            background-color: #2c7be5;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .permission-button:hover {
            background-color: #1a68d1;
        }
        
        .compass {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            border-radius: 50%;
            background-color: #2d2d2d;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5) inset;
        }
        
        .compass-needle {
            position: absolute;
            width: 4px;
            height: 140px;
            background: linear-gradient(to bottom, #f44336 50%, #fff 50%);
            transform-origin: center center;
            transition: transform 0.1s ease;
        }
        
        .compass-center {
            width: 20px;
            height: 20px;
            background-color: #333;
            border-radius: 50%;
            z-index: 1;
        }
        
        .compass-marker {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .compass-marker span {
            position: absolute;
            width: 20px;
            text-align: center;
            font-weight: bold;
            color: #ddd;
        }
        
        .compass-marker .north { top: 10px; left: calc(50% - 10px); }
        .compass-marker .east { right: 10px; top: calc(50% - 10px); }
        .compass-marker .south { bottom: 10px; left: calc(50% - 10px); }
        .compass-marker .west { left: 10px; top: calc(50% - 10px); }
        
        .phone-orientation {
            width: 150px;
            height: 260px;
            margin: 20px auto;
            position: relative;
            perspective: 1200px;
        }
        
        .phone-model {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease;
        }
        
        .phone-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            border: 3px solid #444;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .phone-front {
            background-color: #000;
            transform: translateZ(8px);
        }
        
        .phone-back {
            background-color: #222;
            transform: rotateY(180deg) translateZ(8px);
        }
        
        .phone-left {
            background-color: #333;
            width: 16px;
            height: 100%;
            transform: rotateY(-90deg) translateZ(75px);
        }
        
        .phone-right {
            background-color: #333;
            width: 16px;
            height: 100%;
            transform: rotateY(90deg) translateZ(75px);
        }
        
        .phone-top {
            background-color: #333;
            width: 100%;
            height: 16px;
            transform: rotateX(90deg) translateZ(130px);
        }
        
        .phone-bottom {
            background-color: #333;
            width: 100%;
            height: 16px;
            transform: rotateX(-90deg) translateZ(130px);
        }
        
        .phone-screen {
            position: absolute;
            width: 90%;
            height: 85%;
            top: 30px;
            left: 5%;
            background-color: rgba(120, 180, 255, 0.1);
            border-radius: 5px;
        }
        
        .debug-log {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #87e8de;
        }
        
        .debug-log p {
            margin-bottom: 5px;
            word-break: break-all;
        }
        
        .filter-preview {
            margin-top: 20px;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
        }
        
        .filter-preview h2 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .filter-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .filter-value {
            background-color: #2d2d2d;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .preview-box {
            width: 100%;
            height: 100px;
            background-color: #333;
            background-image: url('/api/placeholder/300/150');
            background-size: cover;
            border-radius: 6px;
            margin-bottom: 10px;
            transition: filter 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mobile Sensor Debug Tool</h1>
        
        <button id="requestPermission" class="permission-button">Enable Sensors</button>
        
        <div class="sensor-section">
            <div class="sensor-heading">
                <h2 class="sensor-title">Accelerometer</h2>
                <span id="accelStatus" class="sensor-status">Checking...</span>
            </div>
            <div class="sensor-values">
                <div class="sensor-value">
                    <div class="value-label">X (m/s²)</div>
                    <div id="accelX" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Y (m/s²)</div>
                    <div id="accelY" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Z (m/s²)</div>
                    <div id="accelZ" class="value-number">0.00</div>
                </div>
            </div>
        </div>
        
        <div class="sensor-section">
            <div class="sensor-heading">
                <h2 class="sensor-title">Gyroscope</h2>
                <span id="gyroStatus" class="sensor-status">Checking...</span>
            </div>
            <div class="sensor-values">
                <div class="sensor-value">
                    <div class="value-label">Alpha (rad/s)</div>
                    <div id="gyroAlpha" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Beta (rad/s)</div>
                    <div id="gyroBeta" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Gamma (rad/s)</div>
                    <div id="gyroGamma" class="value-number">0.00</div>
                </div>
            </div>
        </div>
        
        <div class="sensor-section">
            <div class="sensor-heading">
                <h2 class="sensor-title">Device Orientation</h2>
                <span id="orientStatus" class="sensor-status">Checking...</span>
            </div>
            <div class="sensor-values">
                <div class="sensor-value">
                    <div class="value-label">Alpha (°)</div>
                    <div id="orientAlpha" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Beta (°)</div>
                    <div id="orientBeta" class="value-number">0.00</div>
                </div>
                <div class="sensor-value">
                    <div class="value-label">Gamma (°)</div>
                    <div id="orientGamma" class="value-number">0.00</div>
                </div>
            </div>
            
            <div class="phone-orientation">
                <div id="phoneModel" class="phone-model">
                    <div class="phone-face phone-front">
                        <div class="phone-screen"></div>
                    </div>
                    <div class="phone-face phone-back"></div>
                    <div class="phone-face phone-left"></div>
                    <div class="phone-face phone-right"></div>
                    <div class="phone-face phone-top"></div>
                    <div class="phone-face phone-bottom"></div>
                </div>
            </div>
        </div>
        
        <div class="sensor-section">
            <div class="sensor-heading">
                <h2 class="sensor-title">Compass</h2>
                <span id="compassStatus" class="sensor-status">Checking...</span>
            </div>
            
            <div class="compass">
                <div id="compassNeedle" class="compass-needle"></div>
                <div class="compass-center"></div>
                <div class="compass-marker">
                    <span class="north">N</span>
                    <span class="east">E</span>
                    <span class="south">S</span>
                    <span class="west">W</span>
                </div>
            </div>
        </div>
        
        <div class="filter-preview">
            <h2>Video Filter Preview</h2>
            <div class="filter-values">
                <div class="filter-value">
                    <div class="value-label">Brightness</div>
                    <div id="brightVal" class="value-number">100%</div>
                </div>
                <div class="filter-value">
                    <div class="value-label">Saturation</div>
                    <div id="satVal" class="value-number">100%</div>
                </div>
                <div class="filter-value">
                    <div class="value-label">Contrast</div>
                    <div id="contVal" class="value-number">100%</div>
                </div>
            </div>
            <div id="previewBox" class="preview-box"></div>
        </div>
        
        <div class="debug-log" id="debugLog">
            <p>Sensor debug started. Waiting for permission...</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const requestPermissionBtn = document.getElementById('requestPermission');
            const accelStatus = document.getElementById('accelStatus');
            const gyroStatus = document.getElementById('gyroStatus');
            const orientStatus = document.getElementById('orientStatus');
            const compassStatus = document.getElementById('compassStatus');
            
            const accelX = document.getElementById('accelX');
            const accelY = document.getElementById('accelY');
            const accelZ = document.getElementById('accelZ');
            
            const gyroAlpha = document.getElementById('gyroAlpha');
            const gyroBeta = document.getElementById('gyroBeta');
            const gyroGamma = document.getElementById('gyroGamma');
            
            const orientAlpha = document.getElementById('orientAlpha');
            const orientBeta = document.getElementById('orientBeta');
            const orientGamma = document.getElementById('orientGamma');
            
            const compassNeedle = document.getElementById('compassNeedle');
            const phoneModel = document.getElementById('phoneModel');
            const debugLog = document.getElementById('debugLog');
            
            const previewBox = document.getElementById('previewBox');
            const brightVal = document.getElementById('brightVal');
            const satVal = document.getElementById('satVal');
            const contVal = document.getElementById('contVal');
            
            // Sensor variables
            let accelerometer = null;
            let gyroscope = null;
            let absoluteOrientationSensor = null;
            let deviceOrientationEnabled = false;
            
            // Base filter values
            let brightness = 100;
            let saturation = 100;
            let contrast = 100;
            
            // Log to debug console
            function log(message) {
                const p = document.createElement('p');
                p.textContent = message;
                debugLog.appendChild(p);
                debugLog.scrollTop = debugLog.scrollHeight;
            }
            
            // Format number for display
            function formatNumber(num) {
                return num ? num.toFixed(2) : '0.00';
            }
            
            // Update status indicator
            function updateStatus(element, available) {
                element.textContent = available ? 'Available' : 'Unavailable';
                element.className = available ? 'sensor-status available' : 'sensor-status unavailable';
            }
            
            // Update filter preview
            function updateFilterPreview() {
                previewBox.style.filter = `brightness(${brightness}%) saturate(${saturation}%) contrast(${contrast}%)`;
                brightVal.textContent = `${Math.round(brightness)}%`;
                satVal.textContent = `${Math.round(saturation)}%`;
                contVal.textContent = `${Math.round(contrast)}%`;
            }
            
            // Map orientation values to filter values
            function mapOrientationToFilters(alpha, beta, gamma) {
                // Tilt forward/backward (beta) maps to brightness (50-150%)
                brightness = 100 + Math.round(gamma / 90 * 75);
                brightness = Math.max(25, Math.min(200, brightness));
                
                // Rotation (alpha) maps to saturation (50-200%)
                const alphaNormalized = ((alpha + 180) % 360) - 180; // Normalize -180 to 180
                saturation = 100 + Math.round(alphaNormalized / 180 * 100);
                saturation = Math.max(25, Math.min(200, saturation));
                
                // Tilt left/right (gamma) maps to contrast (50-150%)
                contrast = 100 + Math.round(beta / 90 * 75);
                contrast = Math.max(25, Math.min(200, contrast));
                
                updateFilterPreview();
            }
            
            // Check for Sensor API support
            function checkSensorAvailability() {
                // Check if sensors API is available
                if ('Accelerometer' in window) {
                    try {
                        accelerometer = new Accelerometer({ frequency: 60 });
                        updateStatus(accelStatus, true);
                    } catch (error) {
                        log(`Accelerometer error: ${error.message}`);
                        updateStatus(accelStatus, false);
                    }
                } else {
                    updateStatus(accelStatus, false);
                }
                
                if ('Gyroscope' in window) {
                    try {
                        gyroscope = new Gyroscope({ frequency: 60 });
                        updateStatus(gyroStatus, true);
                    } catch (error) {
                        log(`Gyroscope error: ${error.message}`);
                        updateStatus(gyroStatus, false);
                    }
                } else {
                    updateStatus(gyroStatus, false);
                }
                
                if ('AbsoluteOrientationSensor' in window) {
                    try {
                        absoluteOrientationSensor = new AbsoluteOrientationSensor({ frequency: 60 });
                        updateStatus(orientStatus, true);
                    } catch (error) {
                        log(`Orientation Sensor error: ${error.message}`);
                        updateStatus(orientStatus, false);
                    }
                } else {
                    updateStatus(orientStatus, false);
                }
                
                // Check for DeviceOrientation event as fallback
                if (window.DeviceOrientationEvent) {
                    deviceOrientationEnabled = true;
                    updateStatus(orientStatus, true);
                    updateStatus(compassStatus, true);
                } else {
                    updateStatus(compassStatus, false);
                }
            }
            
            // Request permissions for sensors
            async function requestSensorPermissions() {
                log('Requesting sensor permissions...');
                
                if (!navigator.permissions) {
                    log('Permissions API not supported, trying to use device orientation directly');
                    setupDeviceOrientation();
                    return;
                }
                
                try {
                    const permissions = [];
                    
                    if ('Accelerometer' in window) {
                        permissions.push({ name: 'accelerometer' });
                    }
                    if ('Gyroscope' in window) {
                        permissions.push({ name: 'gyroscope' });
                    }
                    if ('AbsoluteOrientationSensor' in window) {
                        permissions.push({ name: 'magnetometer' });
                    }
                    
                    if (permissions.length > 0) {
                        const results = await Promise.all(
                            permissions.map(permission => 
                                navigator.permissions.query(permission)
                            )
                        );
                        
                        // If all permissions are granted, start the sensors
                        if (results.every(result => result.state === 'granted')) {
                            log('All sensor permissions granted');
                            startSensors();
                        } else {
                            log('Some sensor permissions denied, falling back to device orientation');
                            setupDeviceOrientation();
                        }
                    } else {
                        // Fallback to device orientation if sensors API not available
                        log('Sensors API not available, falling back to device orientation');
                        setupDeviceOrientation();
                    }
                } catch (error) {
                    log(`Error requesting permissions: ${error.message}`);
                    log('Falling back to device orientation');
                    setupDeviceOrientation();
                }
            }
            
            // Start sensor readings
            function startSensors() {
                if (accelerometer) {
                    accelerometer.addEventListener('reading', () => {
                        accelX.textContent = formatNumber(accelerometer.x);
                        accelY.textContent = formatNumber(accelerometer.y);
                        accelZ.textContent = formatNumber(accelerometer.z);
                    });
                    accelerometer.start();
                    log('Accelerometer started');
                }
                
                if (gyroscope) {
                    gyroscope.addEventListener('reading', () => {
                        gyroAlpha.textContent = formatNumber(gyroscope.x);
                        gyroBeta.textContent = formatNumber(gyroscope.y);
                        gyroGamma.textContent = formatNumber(gyroscope.z);
                    });
                    gyroscope.start();
                    log('Gyroscope started');
                }
                
                if (absoluteOrientationSensor) {
                    absoluteOrientationSensor.addEventListener('reading', () => {
                        // Convert quaternion to Euler angles
                        const quaternion = absoluteOrientationSensor.quaternion;
                        // This is a simplification, real conversion is more complex
                        orientAlpha.textContent = formatNumber(quaternion[0] * 180);
                        orientBeta.textContent = formatNumber(quaternion[1] * 180);
                        orientGamma.textContent = formatNumber(quaternion[2] * 180);
                    });
                    absoluteOrientationSensor.start();
                    log('Orientation Sensor started');
                }
                
                // Always try device orientation as a fallback or additional source
                setupDeviceOrientation();
            }
            
            // Setup device orientation event
            function setupDeviceOrientation() {
                if (window.DeviceOrientationEvent) {
                    if (DeviceOrientationEvent.requestPermission) {
                        // iOS 13+ requires user gesture to request permission
                        DeviceOrientationEvent.requestPermission()
                            .then(permissionState => {
                                if (permissionState === 'granted') {
                                    window.addEventListener('deviceorientation', handleOrientation);
                                    log('Device orientation permission granted');
                                    deviceOrientationEnabled = true;
                                } else {
                                    log('Device orientation permission denied');
                                    updateStatus(orientStatus, false);
                                    updateStatus(compassStatus, false);
                                }
                            })
                            .catch(error => {
                                log(`Error requesting device orientation: ${error.message}`);
                                updateStatus(orientStatus, false);
                                updateStatus(compassStatus, false);
                            });
                    } else {
                        // Non-iOS devices don't need permission
                        window.addEventListener('deviceorientation', handleOrientation);
                        log('Device orientation activated');
                        deviceOrientationEnabled = true;
                    }
                } else {
                    log('Device orientation not supported');
                    updateStatus(orientStatus, false);
                    updateStatus(compassStatus, false);
                }
                
                // Also try motion events for accelerometer data
                if (window.DeviceMotionEvent) {
                    if (DeviceMotionEvent.requestPermission) {
                        DeviceMotionEvent.requestPermission()
                            .then(permissionState => {
                                if (permissionState === 'granted') {
                                    window.addEventListener('devicemotion', handleMotion);
                                    log('Device motion permission granted');
                                } else {
                                    log('Device motion permission denied');
                                }
                            })
                            .catch(error => {
                                log(`Error requesting device motion: ${error.message}`);
                            });
                    } else {
                        window.addEventListener('devicemotion', handleMotion);
                        log('Device motion activated');
                    }
                } else {
                    log('Device motion not supported');
                }
            }
            
            // Handle device orientation event
            function handleOrientation(event) {
                const alpha = event.alpha; // Z-axis rotation [0,360)
                const beta = event.beta;   // X-axis rotation [-180,180)
                const gamma = event.gamma; // Y-axis rotation [-90,90)
                
                orientAlpha.textContent = formatNumber(alpha);
                orientBeta.textContent = formatNumber(beta);
                orientGamma.textContent = formatNumber(gamma);
                
                // Update compass
                if (compassNeedle) {
                    compassNeedle.style.transform = `rotate(${alpha}deg)`;
                }
                
                // Update phone model rotation
                if (phoneModel) {
                    phoneModel.style.transform = `rotateY(${gamma}deg) rotateX(${-beta}deg) rotateZ(${alpha}deg)`;
                }
                
                // Map orientation to video filters
                mapOrientationToFilters(alpha, beta, gamma);
            }
            
            // Handle device motion event
            function handleMotion(event) {
                const acceleration = event.accelerationIncludingGravity;
                
                if (acceleration) {
                    accelX.textContent = formatNumber(acceleration.x);
                    accelY.textContent = formatNumber(acceleration.y);
                    accelZ.textContent = formatNumber(acceleration.z);
                }
                
                if (event.rotationRate) {
                    gyroAlpha.textContent = formatNumber(event.rotationRate.alpha);
                    gyroBeta.textContent = formatNumber(event.rotationRate.beta);
                    gyroGamma.textContent = formatNumber(event.rotationRate.gamma);
                }
            }
            
            // Initial check for sensor support
            checkSensorAvailability();
            
            // Set up permission request button
            requestPermissionBtn.addEventListener('click', function() {
                requestSensorPermissions();
            });
            
            // Code to integrate with video player
            function getSensorBasedVideoFilters() {
                return {
                    brightness,
                    saturation,
                    contrast
                };
            }
            
            // Export filter values for use in video player
            window.sensorFilters = getSensorBasedVideoFilters;
            
            // Update preview periodically to demonstrate
            updateFilterPreview();
            
            // Add code to debug
            log('Sensor debug tool ready. Click "Enable Sensors" to start.');
            log('Tilt and rotate your device to see real-time sensor data.');
            log('Watch the filter preview respond to your device movements.');
            log('Integration code for video player:');
            log(`
// In video player code:
// 1. Import filter values:
const filters = window.sensorFilters();

// 2. Apply to video:
videoPlayer.style.filter = \`brightness(\${filters.brightness}%) 
    saturate(\${filters.saturation}%) 
    contrast(\${filters.contrast}%)\`;
            `);
        });
    </script>
</body>
</html>
